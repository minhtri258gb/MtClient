<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8' />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Convert</title>

	<script src="/lib/jquery/jquery-3.7.1.min.js"></script>

	<style>
		body {
			box-sizing: border-box;
			margin: 0;
			padding: 16px;
			height: 100vh;
			display: flex;
			flex-direction: column;
			font-family: MONOSPACE;
		}
	</style>
</head>
<body>

	<h1>Search convert</h1>
	<input type="text" />

	<div id="convertBase64">
		<h2 id="labelBase64">Text -> Base64</h2>
		<input id="directBase64" type="hidden" value="1" />
		<button onclick="mt.switch('Base64')">Switch</button>
		<input id="inputBase64" type="text" />
		<button onclick="mt.convert('Base64')">Convert</button>
		<span id="outputBase64"></span>
	</div>

	<div id="convertURL">
		<h2 id="labelURL">URL -> ParamURL</h2>
		<input id="directURL" type="hidden" value="1" />
		<button onclick="mt.switch('URL')">Switch</button>
		<select id="typeConvertURL">
			<option value="all">All</option>
			<option value="keep">Keep struct</option>
		</select>
		<input id="inputURL" type="text" />
		<button onclick="mt.convert('URL')">Convert</button>
		<span id="outputURL"></span>
	</div>

	<div id="hashString">
		<h2 id="labelHashString">String -> MD5</h2>
		<select id="typeHashString">
			<option value="MD5">MD5</option>
			<option value="SHA1">SHA1</option>
		</select>
		<input id="inputHashString" type="text" />
		<button onclick="mt.convert('HashString')">Convert</button>
		<span id="outputHashString"></span>
	</div>

	<div id="fixUnicode">
		<h2 id="labelFixUnicode">Asscii -> Unicode</h2>
		<input id="inputFixUnicode" type="text" />
		<button onclick="mt.convert('FixUnicode')">Convert</button>
		<span id="outputFixUnicode"></span>
	</div>

	<script type="module">
		import mtImport from '/common/import.js';
		var mt = {

			func: {
				fixUnicode(text) {
					try {
						return text.replace(/\\u\{([0-9A-Fa-f]+)\}|\\u([0-9A-Fa-f]{4})/g, (_, codePoint, hex) =>
							String.fromCodePoint(parseInt(codePoint || hex, 16))
						);
					}
					catch (e) {
						console.error("Decode error:", e);
						return text;
					}
				}
			},

			async init() {
				window.mt = this; // Bind Global
			},
			async convert(type) {
				switch (type) {
					case 'URL':
						let directURL = $('#directURL').val() == '1';
						let typeConvertURL = $('#typeConvertURL').val();
						let valueURL = $('#inputURL').val();
						let resURL = '';
						if (directURL) { // Kiểm tra chiều encode / decode
							if (typeConvertURL == 'all')
								resURL = encodeURIComponent(valueURL);
							else if (typeConvertURL == 'keep')
								resURL = encodeURI(valueURL)
						}
						else {
							if (typeConvertURL == 'all')
								resURL = decodeURIComponent(valueURL);
							else if (typeConvertURL == 'keep')
								resURL = decodeURI(valueURL)
						}
						$('#outputURL').html(resURL);
						break;
					case 'Base64':
						let directBase64 = $('#directBase64').val() == '1';
						let valueBase64 = $('#inputBase64').val();
						let resBase64 = '';
						if (directBase64) // Kiểm tra chiều encode / decode
							resBase64 = btoa(valueBase64);
						else
							resBase64 = atob(valueBase64);
						$('#outputBase64').html(resBase64);
						break;
					case 'HashString':
						let valueHashString = $('#inputHashString').val();
						let typeHashString = $('#typeHashString').val();
						if (typeHashString == 'MD5') {
							let md5 = await mtImport.script('/lib/blueimp-md5/js/md5.min.js', 'md5');
							let resHashString = md5(valueHashString);
							$('#outputHashString').html(resHashString);
						}
						else if (typeHashString == 'SHA-1') {
							// #TODO
						}
						break;
					case 'FixUnicode':
						let valueFixUnicode = $('#inputFixUnicode').val();
						let resFixUnicode = this.func.fixUnicode(valueFixUnicode);
						$('#outputFixUnicode').html(resFixUnicode);
						break;
					default:
						console.error('type:', type);
						alert('Lỗi convert! Ko có type tương ứng!');
				}
			},
			switch(type) {
				switch(type) {
					case 'URL':
						let directURL = $('#directURL').val() == '1';
						directURL = !directURL; // Toggle
						$('#directURL').val(directURL ? '1' : '0');
						$('#labelURL').html(directURL ? 'URL -> ParamURL' : 'ParamURL -> URL');
						break;
					case 'Base64':
						let directBase64 = $('#directBase64').val() == '1';
						directBase64 = !directBase64; // Toggle
						$('#directBase64').val(directBase64 ? '1' : '0');
						$('#labelBase64').html(directBase64 ? 'Text -> Base64' : 'Base64 -> Text');
						break;
					default:
						console.error('type:', type);
						alert('Lỗi swtich! Ko có type tương ứng!');
				}
			},
			search() {
				// #TODO
			},
		};
		document.addEventListener('DOMContentLoaded', () => mt.init());
	</script>

</body>
</html>