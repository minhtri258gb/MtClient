<!DOCTYPE html>
<html lang="vi">
<head>

	<title>PDF</title>

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Permissions-Policy" content="camera=(self)">

	<!-- <link rel="stylesheet" type="text/css" href="/lib/litegraph/litegraph.css"> -->
	<!-- <script type="text/javascript" src="/lib/litegraph/litegraph.js"></script> -->
	<!-- <script type="text/javascript" src="/lib/pdfjs-5.4.54/build/pdf.mjs"></script> -->

	<style>
		body {
			margin: 0px;
			width:100%;
			height:100%;
		}
	</style>

</head>
<body>

	<!--
		https://github.com/jagenjo/litegraph.js
		https://tamats.com/projects/litegraph/editor/
	-->

	<canvas id="the-canvas" style="border: 1px solid black; direction: ltr;"></canvas>

	<script type="module">
		import * as pdfjsLib from '/lib/pdfjs-5.4.54/build/pdf.mjs';
		var mt = {
			m_graph: null,
			m_canvas: null,

			init: async function() {

				// Bind Global
				window.mt = this;

				// Init
				pdfjsLib.GlobalWorkerOptions.workerSrc = '/lib/pdfjs-5.4.54/build/pdf.worker.mjs';
				const url = '/res/pdf/compressed.tracemonkey-pldi-09.pdf';
				const loadingTask = pdfjsLib.getDocument(url);
  			const pdf = await loadingTask.promise;

				const page = await pdf.getPage(1);
				const scale = 1.5;
				const viewport = page.getViewport({ scale });
				// Support HiDPI-screens.
				const outputScale = window.devicePixelRatio || 1;

				//
				// Prepare canvas using PDF page dimensions
				//
				const canvas = document.getElementById("the-canvas");
				const context = canvas.getContext("2d");

				canvas.width = Math.floor(viewport.width * outputScale);
				canvas.height = Math.floor(viewport.height * outputScale);
				canvas.style.width = Math.floor(viewport.width) + "px";
				canvas.style.height = Math.floor(viewport.height) + "px";

				const transform = outputScale !== 1
					? [outputScale, 0, 0, outputScale, 0, 0]
					: null;

				//
				// Render PDF page into canvas context
				//
				const renderContext = {
					canvasContext: context,
					transform,
					viewport,
				};
				page.render(renderContext);

			},
		};
		mt.init();
	</script>
</body>
</html>